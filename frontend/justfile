# Justfile for Rumi Flutter Frontend
# Backend server configuration
set dotenv-load
backend_url := env_var('BACKEND_URL')
transcription_url := env_var('TRANSCRIPTION_URL')

# Check that all required environment variables are set
check-env:
    #!/usr/bin/env bash
    set -euo pipefail
    echo "Checking environment variables..."
    if [ -z "{{backend_url}}" ]; then
        echo "❌ Error: BACKEND_URL is not set in .env file"
        exit 1
    fi
    if [ -z "{{transcription_url}}" ]; then
        echo "❌ Error: TRANSCRIPTION_URL is not set in .env file"
        exit 1
    fi
    echo "✅ BACKEND_URL={{backend_url}}"
    echo "✅ TRANSCRIPTION_URL={{transcription_url}}"
    echo "✅ All environment variables are set"

# Run app on Linux with production backend
run-linux: check-env
    flutter run -d linux --dart-define=BACKEND_URL={{backend_url}} --dart-define=TRANSCRIPTION_URL={{transcription_url}}

# Run app on Android with production backend
run-android: check-env
    flutter run -d $(flutter devices | grep android | head -1 | awk -F'•' '{print $2}' | xargs) --dart-define=BACKEND_URL={{backend_url}} --dart-define=TRANSCRIPTION_URL={{transcription_url}}

# Run app on Linux with local backend (development)
run-linux-dev: check-env
    flutter run -d linux --dart-define=BACKEND_URL={{backend_url}} --dart-define=TRANSCRIPTION_URL={{transcription_url}}

# Run app on Android with local backend (development)
run-android-dev: check-env
    flutter run -d $(flutter devices | grep android | head -1 | awk -F'•' '{print $2}' | xargs) --dart-define=BACKEND_URL={{backend_url}} --dart-define=TRANSCRIPTION_URL={{transcription_url}}

# Build Linux release
build-linux: check-env
    flutter build linux --release --dart-define=BACKEND_URL={{backend_url}} --dart-define=TRANSCRIPTION_URL={{transcription_url}}

# Build Android APK
build-android-apk: check-env
    flutter build apk --release --dart-define=BACKEND_URL={{backend_url}} --dart-define=TRANSCRIPTION_URL={{transcription_url}}

# Build Android App Bundle (for Play Store)
build-android-aab: check-env
    flutter build appbundle --release --dart-define=BACKEND_URL={{backend_url}} --dart-define=TRANSCRIPTION_URL={{transcription_url}}

# Clean build artifacts
clean:
    flutter clean

# Install dependencies
deps:
    flutter pub get

# Run tests
test:
    flutter test

# Format code
format:
    dart format .

# Analyze code
analyze:
    flutter analyze

# Show available devices
devices:
    flutter devices

# Show Flutter doctor info
doctor:
    flutter doctor